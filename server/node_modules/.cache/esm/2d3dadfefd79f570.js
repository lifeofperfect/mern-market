let User;_fd7‍.x([["register",()=>register],["login",()=>login]]);_fd7‍.w("../models/user",[["default",["User"],function(v){User=v}]]);// export const showMessage=(req, res)=> {
//     res.status(200).send(`Here is your message ${req.params.message}`)
// };

const jwt = require("jsonwebtoken")

       const register = async (req, res)=> {
    _fd7‍.g.console.log(req.body)
    const {name,password, email} = req.body

    //validation
    if(!name)
        return res
            .status(400)
            .send("Name is required")
    if(!password || password.length < 7)
        return res
            .status(400)
            .send('Email is required and must ne more than 7 characte3rs')

    let userExists = await User.findOne({email}).exec()
    if(userExists)
        return res
            .status(400)
            .send("Email exists")

    const user = new User(req.body)
    console.log('created')

    try{
        await user.save()
        
        _fd7‍.g.console.log(`user created`, user)
        return res.json({ok: true})
    }catch(err){
        _fd7‍.g.console.log(`USER CREATION FAILED`, err)
        return res
            .status(400)
            .send(`Error try again`)
    }
}


       const login = async (req, res)=> {
    //console.log(req.body);
    const {email, password} = req.body;

    try{

        let user = await User.findOne({email}).exec();
        _fd7‍.g.console.log("User exists", user)
        if(!user)
            res.status(400)
            .send("USER WITH EMAIL   NOT FOUND")

        user.comparePassword(password, (err, match)=> {
            if(!match || err){
                return res
                    .status(400)
                    .send("Wrong Password")
            }

            let token  = jwt.sign({_id: user._id}, process.env.JWT_SECRET, {
                expiresIn: "7d"
            });

            res.json({token, user})
        })

    }catch(err){
        _fd7‍.g.console.log("Login error",err)
        return res
            .status(400)
            .send("Signin failed")
    }
}